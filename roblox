-- Dungeon Lootify All-in-One ESP + Hover GUI (No Hitbox + Heal)
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local lastPositions = {}
local scanInterval = 2
local monsters = {}
local espEnabled = true
local isHealing = false -- ðŸ“Œ à¸•à¸±à¸§à¹à¸›à¸£à¸ªà¸–à¸²à¸™à¸° Healing

-- à¸«à¸² HRP à¸‚à¸­à¸‡à¸œà¸¹à¹‰à¹€à¸¥à¹ˆà¸™
local function getHRP()
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
        return LocalPlayer.Character.HumanoidRootPart
    end
    return nil
end

-- à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ªà¸£à¹‰à¸²à¸‡ ESP
local function createESP(monster)
    if isHealing then return end -- ðŸ“Œ à¸«à¸¢à¸¸à¸”à¸–à¹‰à¸²à¸à¸³à¸¥à¸±à¸‡ Heal
    if monster:FindFirstChild("HumanoidRootPart") and not monster:FindFirstChild("MonsterESP") then
        local billboard = Instance.new("BillboardGui")
        billboard.Name = "MonsterESP"
        billboard.Adornee = monster.HumanoidRootPart
        billboard.Size = UDim2.new(0, 200, 0, 50)
        billboard.StudsOffset = Vector3.new(0, 3, 0)
        billboard.AlwaysOnTop = true

        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(1, 0, 1, 0)
        label.BackgroundTransparency = 1
        label.Text = "[Monster] " .. monster.Name
        label.TextColor3 = Color3.fromRGB(255, 255, 0)
        label.TextStrokeTransparency = 0
        label.Font = Enum.Font.SourceSansBold
        label.TextScaled = true
        label.Name = "ESPLabel"
        label.Parent = billboard

        billboard.Parent = monster
    end
end

-- à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸ªà¹à¸à¸™à¸«à¸²à¹‚à¸¡à¹€à¸”à¸¥à¸¡à¸­à¸™ (à¹„à¸¡à¹ˆà¸£à¸§à¸¡à¸•à¸±à¸§à¸œà¸¹à¹‰à¹€à¸¥à¹ˆà¸™)
local function scanMonsters()
    if isHealing then return end -- ðŸ“Œ à¸«à¸¢à¸¸à¸”à¸ªà¹à¸à¸™à¸•à¸­à¸™ Heal
    monsters = {}
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("Humanoid") and obj.Parent:IsA("Model") then
            local model = obj.Parent
            if model ~= LocalPlayer.Character and model:FindFirstChild("HumanoidRootPart") then
                table.insert(monsters, model)
                if espEnabled then
                    createESP(model)
                end
            end
        end
    end
end

-- à¸ªà¹à¸à¸™à¸­à¸±à¸•à¹‚à¸™à¸¡à¸±à¸•à¸´
task.spawn(function()
    while true do
        task.wait(scanInterval)
        if not isHealing then
            scanMonsters()
        end
    end
end)

-- à¸•à¸£à¸§à¸ˆà¸ˆà¸±à¸šà¸à¸²à¸£à¹€à¸„à¸¥à¸·à¹ˆà¸­à¸™à¹„à¸«à¸§ + à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸ªà¸µ ESP
RunService.RenderStepped:Connect(function()
    if not espEnabled or isHealing then return end
    for _, mob in ipairs(monsters) do
        if mob and mob:FindFirstChild("HumanoidRootPart") then
            local hrp = mob.HumanoidRootPart
            local lastPos = lastPositions[mob] or hrp.Position
            local currentPos = hrp.Position
            local moving = (currentPos - lastPos).Magnitude > 0.1

            local espGui = mob:FindFirstChild("MonsterESP")
            if espGui and espGui:FindFirstChild("ESPLabel") then
                if moving then
                    espGui.ESPLabel.TextColor3 = Color3.fromRGB(255, 0, 0)
                else
                    espGui.ESPLabel.TextColor3 = Color3.fromRGB(255, 255, 0)
                end
            end

            lastPositions[mob] = currentPos
        end
    end
end)

-- à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™à¸«à¸² ESP à¸‚à¸­à¸‡à¸¡à¸­à¸™à¸—à¸µà¹ˆà¹ƒà¸à¸¥à¹‰à¸—à¸µà¹ˆà¸ªà¸¸à¸”
local function getNearestMonster()
    if isHealing then return nil end
    local nearest, nearestDist = nil, math.huge
    local hrp = getHRP()
    if not hrp then return nil end

    for _, mob in ipairs(monsters) do
        if mob and mob:FindFirstChild("HumanoidRootPart") and mob:FindFirstChild("Humanoid") then
            if mob:FindFirstChild("MonsterESP") and mob.Humanoid.Health > 0 then
                local dist = (mob.HumanoidRootPart.Position - hrp.Position).Magnitude
                if dist < nearestDist then
                    nearestDist = dist
                    nearest = mob
                end
            end
        end
    end
    return nearest
end

-- Hover Variables
local hoverConn = nil
local bodyPos = nil
local isHovering = false

-- à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™ Auto Hover
local function autoHoverNearestMonster()
    if isHealing then return end
    local hrp = getHRP()
    if not hrp then return end

    if bodyPos then bodyPos:Destroy() end
    if hoverConn then hoverConn:Disconnect() end

    bodyPos = Instance.new("BodyPosition")
    bodyPos.MaxForce = Vector3.new(1e5,1e5,1e5)
    bodyPos.P = 1e4
    bodyPos.D = 100
    bodyPos.Parent = hrp

    isHovering = true

    hoverConn = RunService.RenderStepped:Connect(function()
        if not isHovering or isHealing then return end
        local target = getNearestMonster()
        if target then
            bodyPos.Position = target.HumanoidRootPart.Position + Vector3.new(0, 5, 0)
        else
            bodyPos.Position = hrp.Position
        end
    end)
end

-- à¸Ÿà¸±à¸‡à¸à¹Œà¸Šà¸±à¸™ Stop Hover
local function stopHover()
    isHovering = false
    if hoverConn then
        hoverConn:Disconnect()
        hoverConn = nil
    end
    if bodyPos then
        bodyPos:Destroy()
        bodyPos = nil
    end
end

-- ==================================================
-- ðŸ“Œ Heal System
local function findNearestSeat()
    local nearest = nil
    local shortest = math.huge
    local hrp = getHRP()
    if not hrp then return nil end

    for _, v in ipairs(workspace:GetDescendants()) do
        if v:IsA("Seat") then
            local dist = (hrp.Position - v.Position).Magnitude
            if dist < shortest then
                shortest = dist
                nearest = v
            end
        end
    end
    return nearest
end

local function healPlayer()
    if isHealing then return end
    isHealing = true
    print("ðŸ’š à¹€à¸£à¸´à¹ˆà¸¡ Heal... à¸£à¸°à¸šà¸šà¸­à¸·à¹ˆà¸™à¸«à¸¢à¸¸à¸”à¸Šà¸±à¹ˆà¸§à¸„à¸£à¸²à¸§")

    stopHover() -- ðŸ“Œ à¸›à¸´à¸” Hover à¸à¹ˆà¸­à¸™
    local char = LocalPlayer.Character
    if not char then isHealing = false return end
    local hrp = char:FindFirstChild("HumanoidRootPart")
    local humanoid = char:FindFirstChild("Humanoid")
    if not hrp or not humanoid then isHealing = false return end

    local seat = findNearestSeat()
    if not seat then
        warn("âŒ à¹„à¸¡à¹ˆà¸¡à¸µà¸—à¸µà¹ˆà¸™à¸±à¹ˆà¸‡ Heal")
        isHealing = false
        return
    end

    local originalCFrame = hrp.CFrame
    local wasAnchored = seat.Anchored
    seat.Anchored = true
    hrp.CFrame = seat.CFrame + Vector3.new(0, 2, 0)

    -- ðŸ“Œ Heal à¸—à¸±à¸™à¸—à¸µà¹€à¸•à¹‡à¸¡
    humanoid.Health = humanoid.MaxHealth
    task.wait(1)

    humanoid.Sit = false
    task.wait(0.1)
    hrp.CFrame = originalCFrame
    seat.Anchored = wasAnchored

    print("âœ… Heal à¹€à¸ªà¸£à¹‡à¸ˆà¸ªà¸´à¹‰à¸™ à¸£à¸°à¸šà¸šà¸­à¸·à¹ˆà¸™à¸à¸¥à¸±à¸šà¸¡à¸²à¸—à¸³à¸‡à¸²à¸™")
    isHealing = false
end

-- ==================================================
-- GUI
local screenGui = Instance.new("ScreenGui", game.CoreGui)

-- à¸›à¸¸à¹ˆà¸¡à¹€à¸›à¸´à¸”/à¸›à¸´à¸” ESP
local toggleButton = Instance.new("TextButton")
toggleButton.Size = UDim2.new(0, 150, 0, 50)
toggleButton.Position = UDim2.new(0, 20, 0, 200)
toggleButton.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
toggleButton.Text = "ESP: ON"
toggleButton.TextScaled = true
toggleButton.Font = Enum.Font.SourceSansBold
toggleButton.TextColor3 = Color3.new(1, 1, 1)
toggleButton.Parent = screenGui

toggleButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    if espEnabled then
        toggleButton.Text = "ESP: ON"
        toggleButton.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
        for _, mob in ipairs(monsters) do
            createESP(mob)
        end
    else
        toggleButton.Text = "ESP: OFF"
        toggleButton.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
        for _, mob in ipairs(monsters) do
            if mob:FindFirstChild("MonsterESP") then
                mob.MonsterESP:Destroy()
            end
        end
    end
end)

-- à¸›à¸¸à¹ˆà¸¡à¹€à¸£à¸´à¹ˆà¸¡ Hover
local tpButton = Instance.new("TextButton")
tpButton.Size = UDim2.new(0, 200, 0, 50)
tpButton.Position = UDim2.new(0, 20, 0, 260)
tpButton.BackgroundColor3 = Color3.fromRGB(0, 0, 170)
tpButton.Text = "Auto Hover Nearest"
tpButton.TextScaled = true
tpButton.Font = Enum.Font.SourceSansBold
tpButton.TextColor3 = Color3.new(1, 1, 1)
tpButton.Parent = screenGui

tpButton.MouseButton1Click:Connect(function()
    autoHoverNearestMonster()
end)

-- à¸›à¸¸à¹ˆà¸¡à¸«à¸¢à¸¸à¸” Hover
local stopButton = Instance.new("TextButton")
stopButton.Size = UDim2.new(0, 150, 0, 50)
stopButton.Position = UDim2.new(0, 20, 0, 320)
stopButton.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
stopButton.Text = "Stop Hover"
stopButton.TextScaled = true
stopButton.Font = Enum.Font.SourceSansBold
stopButton.TextColor3 = Color3.new(1, 1, 1)
stopButton.Parent = screenGui

stopButton.MouseButton1Click:Connect(function()
    stopHover()
end)

-- à¸›à¸¸à¹ˆà¸¡ Heal
local healButton = Instance.new("TextButton")
healButton.Size = UDim2.new(0, 150, 0, 50)
healButton.Position = UDim2.new(0, 20, 0, 380)
healButton.BackgroundColor3 = Color3.fromRGB(0, 170, 170)
healButton.Text = "Heal"
healButton.TextScaled = true
healButton.Font = Enum.Font.SourceSansBold
healButton.TextColor3 = Color3.new(1, 1, 1)
healButton.Parent = screenGui

healButton.MouseButton1Click:Connect(function()
    healPlayer()
end)
