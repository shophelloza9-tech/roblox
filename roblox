-- AutoFarm Module
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")

player.CharacterAdded:Connect(function(char)
    character = char
    humanoid = char:WaitForChild("Humanoid")
end)

local AutoFarm = {}
AutoFarm.Enabled = false
AutoFarm.Range = 10
AutoFarm.Damage = 10

-- ตรวจสอบ NPC
local function isNPC(model)
    if not model:IsA("Model") then return false end
    if Players:GetPlayerFromCharacter(model) then return false end
    return model:FindFirstChild("Humanoid") and model:FindFirstChild("HumanoidRootPart")
end

-- คืนค่ารายการ Humanoid ที่อยู่ในระยะ
local function getNearbyNPCs()
    local npcs = {}
    local hrp = character:FindFirstChild("HumanoidRootPart")
    if not hrp then return npcs end
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("Model") and obj:FindFirstChild("Humanoid") and obj:FindFirstChild("HumanoidRootPart") then
            if not Players:GetPlayerFromCharacter(obj) then
                local dist = (hrp.Position - obj.HumanoidRootPart.Position).Magnitude
                if dist <= AutoFarm.Range then
                    table.insert(npcs, obj.Humanoid)
                end
            end
        end
    end
    return npcs
end

-- Loop ตี NPC ใกล้ตัว
RunService.Stepped:Connect(function()
    if AutoFarm.Enabled then
        for _, npcHumanoid in ipairs(getNearbyNPCs()) do
            if npcHumanoid.Health > 0 then
                npcHumanoid:TakeDamage(AutoFarm.Damage)
            end
        end
    end
end)

-- Toggle AutoFarm
function AutoFarm:Toggle()
    self.Enabled = not self.Enabled
    return self.Enabled
end

return AutoFarm
