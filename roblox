local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer

local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local hrp = character:WaitForChild("HumanoidRootPart")

player.CharacterAdded:Connect(function(char)
	character = char
	humanoid = char:WaitForChild("Humanoid")
	hrp = char:WaitForChild("HumanoidRootPart")
end)

-- AutoFarm
local AutoFarmEnabled = false
local AutoFarmRange = 30
local AutoFarmDamage = 10

-- ตรวจสอบ NPC
local function isNPC(model)
	if not model:IsA("Model") then return false end
	if Players:GetPlayerFromCharacter(model) then return false end
	return model:FindFirstChild("Humanoid") and model:FindFirstChild("HumanoidRootPart")
end

-- หา NPC ใกล้ตัว
local function getNearbyNPCs()
	local npcs = {}
	if not hrp then return npcs end
	for _, obj in ipairs(workspace:GetDescendants()) do
		if obj:IsA("Model") and isNPC(obj) then
			local npcHRP = obj:FindFirstChild("HumanoidRootPart")
			if npcHRP and (hrp.Position - npcHRP.Position).Magnitude <= AutoFarmRange then
				table.insert(npcs, obj.Humanoid)
			end
		end
	end
	return npcs
end

-- AutoFarm Loop
RunService.Stepped:Connect(function()
	if AutoFarmEnabled and humanoid and hrp then
		for _, npcHum in ipairs(getNearbyNPCs()) do
			if npcHum and npcHum.Health > 0 then
				local npcHRP = npcHum.Parent:FindFirstChild("HumanoidRootPart")
				if npcHRP then
					-- ย้ายผู้เล่นไปบนหัวมอน
					hrp.CFrame = npcHRP.CFrame + Vector3.new(0, 5, 0)
					-- ตี Humanoid
					npcHum:TakeDamage(AutoFarmDamage)
				end
			end
		end
	end
end)
