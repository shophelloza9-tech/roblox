local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")

-- Re-get character on respawn
player.CharacterAdded:Connect(function(char)
	character = char
	humanoid = char:WaitForChild("Humanoid")
end)

-- UI creation
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "OneClickTeleportGUI"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

-- Function to create styled buttons
local function createButton(name, position, text, bgColor)
	local btn = Instance.new("TextButton")
	btn.Name = name
	btn.Size = UDim2.new(0, 180, 0, 50)
	btn.Position = position
	btn.Text = text
	btn.BackgroundColor3 = bgColor
	btn.TextColor3 = Color3.new(1, 1, 1)
	btn.Font = Enum.Font.SourceSansBold
	btn.TextSize = 20
	btn.Parent = screenGui
	btn.AutoButtonColor = true
	btn.TextWrapped = true
	return btn
end

-- Buttons
local exitButton = createButton("ExitButton", UDim2.new(0, 10, 0, 10), "Exit", Color3.fromRGB(180, 0, 0))
local teleportButton = createButton("TeleportButton", UDim2.new(0, 10, 0, 70), "Bring Enemies (R)", Color3.fromRGB(0, 180, 90))
local healButton = createButton("HealButton", UDim2.new(0, 10, 0, 130), "Heal (F)", Color3.fromRGB(200, 100, 100))
local speedButton = createButton("SpeedButton", UDim2.new(0, 10, 0, 190), "Speed (G): OFF", Color3.fromRGB(255, 200, 50))

-- Settings
local maxDistance = 80
local speedEnabled = false

-- Utility: Check if model is NPC
local function isNPC(model)
	if not model:IsA("Model") then return false end
	if Players:GetPlayerFromCharacter(model) then return false end
	return model:FindFirstChild("Humanoid") and model:FindFirstChild("HumanoidRootPart")
end

-- Teleport Nearby NPCs (เรียงวงกลม ปลอดภัย)
local function teleportNearbyNPCsAdvanced()
	local char = player.Character
	if not char then return end
	local myHRP = char:FindFirstChild("HumanoidRootPart")
	if not myHRP then return end

	local npcs = {}
	for _, obj in ipairs(workspace:GetDescendants()) do
		if obj:IsA("Part") and obj.Name == "HumanoidRootPart" then
			local npc = obj.Parent
			if isNPC(npc) then
				local distance = (obj.Position - myHRP.Position).Magnitude
				if distance <= maxDistance then
					table.insert(npcs, obj)
				end
			end
		end
	end

	if #npcs == 0 then return end

	local radius = 5
	local angleStep = (2 * math.pi) / #npcs
	for i, npcHRP in ipairs(npcs) do
		local angle = i * angleStep
		local offsetPosition = Vector3.new(
			math.cos(angle) * radius + math.random(-1,1),
			0,
			math.sin(angle) * radius + math.random(-1,1)
		)
		npcHRP.CFrame = myHRP.CFrame + offsetPosition
	end
end

-- Heal player by filling Humanoid HP directly
local function healPlayer()
	if not humanoid then return end
	humanoid.Health = humanoid.MaxHealth
end

-- Toggle speed
local function toggleSpeed()
	speedEnabled = not speedEnabled
	speedButton.Text = "Speed (G): " .. (speedEnabled and "ON" or "OFF")
	if not speedEnabled and humanoid then
		humanoid.WalkSpeed = 16
	end
end

-- Infinite jump
UserInputService.JumpRequest:Connect(function()
	if humanoid then
		humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
	end
end)

-- Speed loop
RunService.Stepped:Connect(function()
	if speedEnabled and humanoid then
		humanoid.WalkSpeed = 60
	end
end)

-- Connect buttons
teleportButton.MouseButton1Click:Connect(teleportNearbyNPCsAdvanced)
healButton.MouseButton1Click:Connect(healPlayer)
speedButton.MouseButton1Click:Connect(toggleSpeed)

-- Hotkeys
UserInputService.InputBegan:Connect(function(input, gameProcessed)
	if gameProcessed then return end
	if input.KeyCode == Enum.KeyCode.R then
		teleportNearbyNPCsAdvanced()
	elseif input.KeyCode == Enum.KeyCode.F then
		healPlayer()
	elseif input.KeyCode == Enum.KeyCode.G then
		toggleSpeed()
	end
end)

-- Exit button click
exitButton.MouseButton1Click:Connect(function()
	screenGui:Destroy()
end)
